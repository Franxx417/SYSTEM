document.addEventListener("DOMContentLoaded",function(){var o=document.getElementById("supplier-vat"),r=document.getElementById("supplier-select"),s=document.getElementById("manual-supplier-fields");function y(){if(!(!r||!o)){var e=r.options[r.selectedIndex];if(o.textContent=e&&e.dataset&&e.dataset.vat?e.dataset.vat:"â€”",r&&r.value==="__manual__"){s&&s.classList.remove("d-none");var l=document.getElementById("supplier-vat-type");l&&(o.textContent=l.value||"VAT");var u=[["supplier-name","new_supplier[name]"],["supplier-vat-type","new_supplier[vat_type]"],["supplier-address","new_supplier[address]"],["supplier-contact-person","new_supplier[contact_person]"],["supplier-contact-number","new_supplier[contact_number]"],["supplier-tin","new_supplier[tin_no]"]];u.forEach(function(n){var i=document.getElementById(n[0]);i&&i.setAttribute("name",n[1])})}else s&&s.classList.add("d-none"),["supplier-name","supplier-vat-type","supplier-address","supplier-contact-person","supplier-contact-number","supplier-tin"].forEach(function(n){var i=document.getElementById(n);i&&i.removeAttribute("name")})}}r&&(r.addEventListener("change",y),y());var h=document.getElementById("supplier-vat-type");h&&h.addEventListener("change",function(){r&&r.value==="__manual__"&&o&&(o.textContent=this.value)});var c=document.getElementById("items");function v(){var e=0;c&&Array.prototype.forEach.call(c.querySelectorAll(".item-row"),function(d){var m=parseFloat((d.querySelector('input[name$="[quantity]"]')||{}).value||"0"),f=parseFloat((d.querySelector(".unit-price")||{}).value||"0");e+=(isNaN(m)?0:m)*(isNaN(f)?0:f)});var l=0,u=0,n=document.getElementById("calc-subtotal"),i=document.getElementById("calc-vat"),p=document.getElementById("calc-total");n&&(n.value=""),i&&(i.value=""),p&&(p.textContent=(Math.round((e-u+l)*100)/100).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))}c&&c.addEventListener("input",function(e){(e.target.matches(".unit-price")||e.target.name&&e.target.name.endsWith("[quantity]"))&&v()}),v(),typeof window<"u"&&window.jQuery&&jQuery(function(e){var l=e("#date-from"),u=e("#date-to");l.length&&u.length&&(l.datepicker({dateFormat:"yy-mm-dd",onSelect:function(t){u.datepicker("option","minDate",t)}}),u.datepicker({dateFormat:"yy-mm-dd",onSelect:function(t){l.datepicker("option","maxDate",t)}}));var n=e("#purpose-input"),i=e("#text-count"),p=n.attr("maxlength");if(n.length&&i.length&&p){let t=function(){var a=p-n.val().length;i.text(a+" characters remaining").toggleClass("text-danger",a<=20).toggleClass("text-muted",a>20)};var f=t;t(),n.on("input",t)}function d(){var t=e(this),a=t.val().replace(/[^0-9.]/g,""),g=a.split(".");g.length>2&&(a=g[0]+"."+g.slice(1).join(""));var E=parseFloat(a);(E<0||isNaN(E))&&(a="0.00"),t.val(a)}function m(){var t=e(this),a=parseFloat(t.val());t.val(isNaN(a)?"0.00":a.toFixed(2))}e("#calc-shipping-input, #calc-discount-input").on("input",d).on("blur",m).on("input",v)})});
