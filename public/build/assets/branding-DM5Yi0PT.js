document.addEventListener("DOMContentLoaded",function(){const c=document.getElementById("branding-form");if(!c)return;const u=document.getElementById("logo"),r=document.getElementById("logo-drop-zone"),h=document.getElementById("logo-preview"),B=document.getElementById("logo-preview-container"),I=document.getElementById("logo-upload-prompt"),V=document.getElementById("remove-logo-btn"),a=document.getElementById("app_name"),G=document.getElementById("app_tagline"),D=document.getElementById("app_description"),f=document.getElementById("logo_position"),L=document.getElementById("logo_size"),R=document.getElementById("logo_size_value"),m=document.getElementById("primary_color"),w=document.getElementById("primary_color_hex"),v=document.getElementById("secondary_color"),b=document.getElementById("secondary_color_hex"),g=document.getElementById("accent_color"),C=document.getElementById("accent_color_hex"),k=document.getElementById("font_family"),x=document.getElementById("font_size"),U=document.getElementById("font_size_value"),j=document.getElementById("preview-app-name"),F=document.getElementById("preview-app-tagline"),l=document.getElementById("preview-logo"),_=document.getElementById("preview-logo-container"),i=document.getElementById("preview-text"),p=document.getElementById("preview-btn-primary"),y=document.getElementById("preview-btn-secondary"),E=document.getElementById("preview-btn-accent"),M=document.getElementById("preview-link"),z=document.getElementById("preview-alert"),$=document.getElementById("unsaved-changes");let T=!1;new FormData(c);function n(){T=!0,$&&($.style.display="inline-block")}if(D){const e=document.getElementById("desc_count"),t=()=>{e&&(e.textContent=D.value.length)};D.addEventListener("input",t),t()}u&&r&&(r.addEventListener("click",function(e){e.target.closest("#remove-logo-btn")||u.click()}),r.addEventListener("keypress",function(e){(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),u.click())}),u.addEventListener("change",function(e){N(e.target.files[0])}),r.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),this.classList.add("drag-over")}),r.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation(),this.classList.remove("drag-over")}),r.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),this.classList.remove("drag-over");const t=e.dataTransfer.files;t.length>0&&N(t[0])}),V&&V.addEventListener("click",function(e){e.stopPropagation(),O(),u.value="",n()}));function N(e){if(!e)return;if(!["image/png","image/jpeg","image/jpg","image/svg+xml"].includes(e.type)){q("Please upload a PNG, JPG, or SVG file.");return}const s=2*1024*1024;if(e.size>s){q("File size must be less than 2MB.");return}const S=new FileReader;S.onload=function(H){h&&B&&I&&(h.src=H.target.result,B.style.display="block",I.style.display="none",l&&(l.src=H.target.result,l.style.display="block"),n())},S.readAsDataURL(e)}function O(){h&&B&&I&&(h.src="",B.style.display="none",I.style.display="block")}function q(e){const t=document.getElementById("logo-error");t&&(t.textContent=e,t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3))}a&&j&&a.addEventListener("input",function(){j.textContent=this.value||"Procurement System",n()}),G&&F&&G.addEventListener("input",function(){F.textContent=this.value,F.style.display=this.value?"block":"none",n()}),f&&_&&f.addEventListener("change",function(){_.style.justifyContent=this.value==="center"?"center":this.value==="right"?"flex-end":"flex-start",n()}),L&&R&&l&&L.addEventListener("input",function(){const e=this.value+"px";R.textContent=e,l.style.height=e,n()}),m&&w&&(m.addEventListener("input",function(){w.value=this.value,o("primary",this.value),n()}),w.addEventListener("input",function(){P(this.value)&&(m.value=this.value,o("primary",this.value),n())})),v&&b&&(v.addEventListener("input",function(){b.value=this.value,o("secondary",this.value),n()}),b.addEventListener("input",function(){P(this.value)&&(v.value=this.value,o("secondary",this.value),n())})),g&&C&&(g.addEventListener("input",function(){C.value=this.value,o("accent",this.value),n()}),C.addEventListener("input",function(){P(this.value)&&(g.value=this.value,o("accent",this.value),n())}));function P(e){return/^#[0-9A-F]{6}$/i.test(e)}function o(e,t){e==="primary"?(p&&(p.style.backgroundColor=t,p.style.borderColor=t,p.style.color=A(t)),M&&(M.style.color=t)):e==="secondary"?y&&(y.style.backgroundColor=t,y.style.borderColor=t,y.style.color=A(t)):e==="accent"&&(E&&(E.style.backgroundColor=t,E.style.borderColor=t,E.style.color=A(t)),z&&(z.style.backgroundColor=t+"20",z.style.borderColor=t,z.style.color=t))}function A(e){const t=parseInt(e.substr(1,2),16),s=parseInt(e.substr(3,2),16),S=parseInt(e.substr(5,2),16);return(t*299+s*587+S*114)/1e3>=128?"#000000":"#ffffff"}k&&i&&k.addEventListener("change",function(){const e=this.value;i.style.fontFamily=e==="system-ui"?'system-ui, -apple-system, "Segoe UI", Roboto, sans-serif':`"${e}", sans-serif`,e!=="system-ui"&&!["Arial","Helvetica","Georgia","Times New Roman"].includes(e)&&Z(e),n()}),x&&U&&i&&x.addEventListener("input",function(){const e=this.value+"px";U.textContent=e,i.style.fontSize=e,n()});function Z(e){const t="google-font-"+e.replace(/\s+/g,"-");if(!document.getElementById(t)){const s=document.createElement("link");s.id=t,s.rel="stylesheet",s.href=`https://fonts.googleapis.com/css2?family=${e.replace(/\s+/g,"+")}:wght@400;500;600;700&display=swap`,document.head.appendChild(s)}}const J=document.getElementById("reset-btn");J&&J.addEventListener("click",function(){T?confirm("Are you sure you want to reset all changes? This will discard any unsaved modifications.")&&(c.reset(),location.reload()):c.reset()});const d=document.getElementById("save-btn");c.addEventListener("submit",function(e){d&&(d.disabled=!0,d.innerHTML='<span class="spinner-border spinner-border-sm me-1"></span>Saving...'),K()||(e.preventDefault(),d&&(d.disabled=!1,d.innerHTML='<i class="fas fa-save me-1"></i>Save Branding'))});function K(){let e=!0;return a&&!a.value.trim()?(a.classList.add("is-invalid"),e=!1):a&&a.classList.remove("is-invalid"),[w,b,C].forEach(t=>{t&&t.value&&!P(t.value)?(t.classList.add("is-invalid"),e=!1):t&&t.classList.remove("is-invalid")}),e}window.addEventListener("beforeunload",function(e){if(T)return e.preventDefault(),e.returnValue="",""});function Q(){if(m&&p&&o("primary",m.value),v&&y&&o("secondary",v.value),g&&E&&o("accent",g.value),k&&i){const e=k.value;i.style.fontFamily=e==="system-ui"?'system-ui, -apple-system, "Segoe UI", Roboto, sans-serif':`"${e}", sans-serif`}x&&i&&(i.style.fontSize=x.value+"px"),L&&l&&(l.style.height=L.value+"px"),f&&_&&(_.style.justifyContent=f.value==="center"?"center":f.value==="right"?"flex-end":"flex-start")}Q(),console.log("Branding tab initialized with real-time preview")});
